{% extends "base.html" %}

{% block title %}- Edit Timeslot{% endblock %}

{% block content %}

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card raised-table">
        <h5 class="card-header">
          Edit Timeslot
        </h5>
        <div class="card-body">
          <h3 class="card-title text-center"></h3>
          <!--Content to be here-->

          <form id="editTimeslot" name="editTimeslot" action="{{url_for('update_timeslot',id=timeslot.id)}}" method="post" class="needs-validation" novalidate>
            <div class="form-group">
              <label for="time_code">Time code:</label>
              <input type="text" class="form-control" id="time_code" placeholder="Enter Time code" name="time_code" required maxlength="20" minlength="10" style="text-transform: uppercase" value="{{timeslot.time_code}}" readonly>
              <div class="valid-feedback">Valid.</div>
              <div class="invalid-feedback">Please fill out this field.</div>
            </div>
            <div class="form-group">
              <label for="start_time">Start Time:</label>
              <input type="text" class="form-control" id="start_time" name="start_time" placeholder="Enter Start time in HH:MM:SS format" value="{{timeslot.start_time}}" required>
              <div class="valid-feedback">Valid.</div>
              <div class="invalid-feedback">Please fill out this field.</div>
            </div>    
            <div class="form-group">
              <label for="end_time">End Time:</label>
              <input type="text" class="form-control" id="end_time" name="end_time" placeholder="Enter End time in HH:MM:SS format" value="{{timeslot.end_time}}" required>
              <div class="valid-feedback">Valid.</div>
              <div class="invalid-feedback">Please fill out this field.</div>
            </div>   
            <button class="form-control btn-success btn-block" type="submit">Update Timeslot</button>
            <button type="button" class="btn btn-danger btn-block" onclick="redirectToTimeslots()">View Timeslot(s)</button> 
             </form>


        </div>
      </div>
    </div>
  </div>
</div>
<script>
(function () {
  'use strict';
  window.addEventListener('load', function () {
    var form = document.getElementById('editTimeslot');
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  }, false);
})();

  // JavaScript to enforce HH:MM:SS format
  document.addEventListener('DOMContentLoaded', function() {
    const timeInputs = document.querySelectorAll('input[type="text"][name*="_time"]');
    timeInputs.forEach(function(input) {
      input.addEventListener('input', function() {
        const value = this.value.replace(/[^0-9:]/g, ''); // Keep only numbers and ':'
        const segments = value.split(':');
        if (segments.length > 3) {
          this.value = segments.slice(0, 3).join(':');
        } else if (segments.length === 3) {
          const hours = parseInt(segments[0], 10);
          const minutes = parseInt(segments[1], 10);
          const seconds = parseInt(segments[2], 10);
          if (hours >= 0 && hours < 24 && minutes >= 0 && minutes < 60 && seconds >= 0 && seconds < 60) {
            this.value = segments.join(':');
          }
        }
      });
    });
  });
</script>

{% endblock %}